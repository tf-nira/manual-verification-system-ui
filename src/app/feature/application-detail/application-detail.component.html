<div class="container">
  <!-- Header Section -->
  <app-header [role]="role"></app-header>

  <div class="layout">
    <!-- Left Section -->
<div class="left-section" [class.collapsed]="isLeftCollapsed">
  <div class="section-header">
    <h3>Navigation</h3>
    <button class="toggle-btn" (click)="toggleLeft()">
      <i class="fas fa-toggle-on"></i>
    </button>
  </div>
  <div class="navigation-content">
    <div class="info-item">
      <span class="label">ID</span>
      <span class="value">{{ applicationId || 'N/A' }}</span>
    </div>
    <div class="info-item">
      <span class="label">Status</span>
      <span class="value">{{'Pending' }}</span>
    </div>
    <div class="info-item">
      <span class="label">Service</span>
      <span class="value">{{ service || 'By Birth' }}</span>
    </div>
    <div class="info-item">
      <span class="label">Service Type</span>
      <span class="value">{{ serviceType || 'Section ABC' }}</span>
    </div>
  </div>
</div>



    <!-- Middle Section -->
    <div class="middle-section">
      <h3>Applicant - Personal Information</h3>
      <div class="personal-information">

        <div class="form-group">
          <label>Gender</label>
          <div class="field-container">
            {{ parseJson(rowData?.demographics?.gender)?.[0]?.value }}
          </div>
        </div>
        <div class="form-group">
          <label>Place of Residence (District)</label>
          <div class="field-container">
            {{ parseJson(rowData?.demographics?.applicantPlaceOfResidenceDistrict)?.[0]?.value }}
          </div>
        </div>
        <div class="form-group">
          <label>Phone</label>
          <div class="field-container">
            {{ rowData?.demographics?.phone }}
          </div>
        </div>
        <div class="form-group">
          <label>Date of Birth</label>
          <div class="field-container">
            {{ rowData?.demographics?.dateOfBirth }}
          </div>
        </div>
      </div>
    </div>


    <!-- Right Section -->
    <div class="right-section" [class.collapsed]="isRightCollapsed">
      <div class="section-header">
        <h3>References</h3>
        <button class="toggle-btn" (click)="toggleRight()">
          <i class="fas fa-toggle-on"></i> </button>
      </div>
      <div class="references-content">
        <div class="tabs">
          <button class="tab-button" [class.active]="activeTab === 'history'" (click)="setActiveTab('history')">
            <i class="icon-history"></i> History
          </button>
          <button class="tab-button" [class.active]="activeTab === 'records'" (click)="setActiveTab('records')">
            <i class="icon-records"></i> Records
          </button>
          <button class="tab-button" [class.active]="activeTab === 'documents'" (click)="setActiveTab('documents')">
            <i class="icon-documents"></i> Documents
          </button>
        </div>

        <div class="tab-content" *ngIf="activeTab === 'history'">
          <!-- History Content -->
          <div class="details-container">
          <h3>Details for Application ID: {{ this.rowData.applicationId}}</h3>


          <div *ngIf="selectedRow">
            <!-- Officer Escalation Details -->
            <div *ngIf="selectedRow.officerEscDetails" class="escalation-section">
              <button class="escalation-header" (click)="toggleEscalation('officer')">
                Officer Escalation Details
                <span [class]="isEscalationExpanded('officer') ? 'expanded' : 'collapsed'"></span>
              </button>
              <div *ngIf="isEscalationExpanded('officer')" class="escalation-content">
                <p><strong>Level:</strong> {{ selectedRow.officerEscDetails.level || 'N/A' }}</p>
                <p><strong>Category:</strong> {{ selectedRow.officerEscDetails.category || 'N/A' }}</p>
                <p><strong>Comment:</strong> {{ selectedRow.officerEscDetails.comment || 'N/A' }}</p>
                <p><strong>Escalated By:</strong> {{ selectedRow.officerEscDetails.escBy || 'N/A' }}</p>
                <p><strong>Escalation Time:</strong> {{ selectedRow.officerEscDetails.escDTimes || 'N/A' }}</p>
              </div>
            </div>

            <!-- Supervisor Escalation Details -->
            <div *ngIf="selectedRow.supervisorEscDetails" class="escalation-section">
              <button class="escalation-header" (click)="toggleEscalation('supervisor')">
                Supervisor Escalation Details
                <span [class]="isEscalationExpanded('supervisor') ? 'expanded' : 'collapsed'"></span>
              </button>
              <div *ngIf="isEscalationExpanded('supervisor')" class="escalation-content">
                <p><strong>Level:</strong> {{ selectedRow.supervisorEscDetails.level || 'N/A' }}</p>
                <p><strong>Category:</strong> {{ selectedRow.supervisorEscDetails.category || 'N/A' }}</p>
                <p><strong>Comment:</strong> {{ selectedRow.supervisorEscDetails.comment || 'N/A' }}</p>
                <p><strong>Escalated By:</strong> {{ selectedRow.supervisorEscDetails.escBy || 'N/A' }}</p>
                <p><strong>Escalation Time:</strong> {{ selectedRow.supervisorEscDetails.escDTimes || 'N/A' }}</p>
              </div>
            </div>

            <!-- Legal Escalation Details -->
            <div *ngIf="selectedRow.legalEscDetails" class="escalation-section">
              <button class="escalation-header" (click)="toggleEscalation('legal')">
                Legal Escalation Details
                <span [class]="isEscalationExpanded('legal') ? 'expanded' : 'collapsed'"></span>
              </button>
              <div *ngIf="isEscalationExpanded('legal')" class="escalation-content">
                <p><strong>Level:</strong> {{ selectedRow.legalEscDetails.level || 'N/A' }}</p>
                <p><strong>Category:</strong> {{ selectedRow.legalEscDetails.category || 'N/A' }}</p>
                <p><strong>Comment:</strong> {{ selectedRow.legalEscDetails.comment || 'N/A' }}</p>
                <p><strong>Escalated By:</strong> {{ selectedRow.legalEscDetails.escBy || 'N/A' }}</p>
                <p><strong>Escalation Time:</strong> {{ selectedRow.legalEscDetails.escDTimes || 'N/A' }}</p>
              </div>
            </div>
          </div>

          <div *ngIf="!selectedRow">
            <p>No row selected. Click on a row to see details.</p>
          </div>
        </div>
        </div>
        <!-- Records Content -->
        <div class="tab-content" *ngIf="activeTab === 'records'">
          <div class="scrollable-container">
            <!-- Check if there are person details -->
            <ng-container *ngIf="personDetails.length > 0; else noData">
              <div *ngFor="let person of personDetails">
                <h4>{{ person.role | titlecase }} Details</h4>
                <div *ngFor="let key of objectKeys(person.details)">
                  <p>{{ formatKey(key) }}: {{ person.details[key] }}</p>
                </div>
                <button (click)="showDemographicData(person.details[person.role + 'Nin'])">Open</button>
                 </div>

            </ng-container>
            <ng-template #noData>
              <p>No NIN data found for Father, Mother, or Guardian.</p>
            </ng-template>
          </div>
        </div>


        <div class="tab-content" *ngIf="activeTab === 'documents'">
          <!-- Documents Content -->
          <p>Documents content goes here...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Back Button -->
  <div class="footer">
    <button class="back-button" (click)="goBack()">{{ constants.BACK }}</button>
  </div>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="approve" (click)="openApprovalModal()">
      <i class="fas fa-check-circle"></i>
      {{ constants.APPROVE }}
    </button>
    <button class="escalate" *ngIf="role !== 'MVS_DISTRICT_OFFICER' && role !== 'MVS_EXECUTIVE_DIRECTOR'"
      (click)="openEscalateModal()">
      <i class="fas fa-exclamation-triangle"></i>
      {{ constants.ESCALATE }}
    </button>
    <button class="reject" (click)="openRejectModal()">
      <i class="fas fa-times-circle"></i>
      {{ constants.REJECT }}
    </button>
    <!-- Schedule Interview Btn -->
    <button [ngClass]="{
        'schedule-interview': (role === 'MVS_LEGAL_OFFICER' || role === 'MVS_DISTRICT_OFFICER') ,
        'hidden': (role === 'MVS_OFFICER' || role === 'MVS_SUPERVISOR')
      }" (click)="openScheduleInterviewModal()">
      {{ constants.SCHEDULE_INTERVIEW }}
    </button>
    <!-- Document Upload Btn -->
    <button [ngClass]="{
        'document-upload': role === 'MVS_DISTRICT_OFFICER',
        'hidden': role !== 'MVS_DISTRICT_OFFICER'
      }" (click)="openDocumentUploadwModal()">
      {{ constants.UPLOAD_DCOUMENTS }}
    </button>
  </div>

  <!-- Approval Modal -->
  <div id="approvalModal" class="modal" [class.show]="showApprovalModal">
    <div class="modal-content">
      <span class="close-button" (click)="closeApprovalModal()">&times;</span>
      <h2>Approve Application?</h2>
      <div class="modal-body">
        <label>
          <input type="checkbox" [(ngModel)]="isChecked" />
          I have reviewed all the details in the application and found them acceptable.
        </label>
        <div class="comments-section">
          <label for="comments">Comments</label>
          <textarea id="comments" [(ngModel)]="approvalComment" placeholder="Enter your comments"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-button" (click)="closeApprovalModal()">Cancel</button>
        <button class="approve-button" [disabled]="!isChecked" (click)="approveApplication()">Approve</button>
      </div>
    </div>
  </div>

  <!-- Escalate Modal -->
  <div class="escalateModal" *ngIf="showEscalateModal">
    <div class="modal-content">
      
    <button class="close-button" (click)="closeEscalateModal()">×</button>
      <div class="modal-header">
        <h3>Escalate Application?</h3>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Change Officer Level <span title="Select the officer level to escalate to.">ℹ️</span></label>
          <select [(ngModel)]="selectedOfficerLevel" class="dropdown">
            <option *ngFor="let option of dropdownOptions" [value]="option.value" [selected]="option.default">
              {{ option.label }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="escalate-comments">Comments <span title="Comments are required."> *</span></label>
          <textarea id="escalate-comments" [(ngModel)]="escalationComment" placeholder="Enter your comments"
            required></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn cancel" (click)="closeEscalateModal()">Cancel</button>
        <button class="btn escalate" [disabled]="!escalationComment.trim()" (click)="escalateApplication()">
          Escalate
        </button>
      </div>
    </div>
  </div>


  <!-- Reject Modal -->
  <div class="rejectModal" [class.show]="showRejectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Reject Application?</h3>
        <button class="close-button" (click)="closeRejectModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Reason Category <span title="Select the reason for rejection.">*</span></label>
          <select [(ngModel)]="rejectionCategory" class="dropdown">
            <option value="" disabled selected>-Select Reason Category-</option>
            <option value="invalid-information">Invalid Information</option>
            <option value="incomplete-documents">Incomplete Documents</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="reject-comments">Comments <span title="Comments are required."> *</span></label>
          <textarea id="reject-comments" [(ngModel)]="rejectionComment" placeholder="Enter your comments"
            required></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn cancel" (click)="closeRejectModal()">Cancel</button>
        <button class="btn reject" [disabled]="!rejectionCategory || !rejectionComment.trim()"
          (click)="rejectApplication()">
          Reject
        </button>
      </div>
    </div>
  </div>


  <!-- Schedule Interview Modal -->
  <div class="interviewModal" *ngIf="showScheduleInterviewModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Schedule a Meeting</h3>
        <button class="close-button" (click)="closeScheduleInterviewModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="subject">Subject*</label>
          <input id="subject" type="text" placeholder="Interview Subject*" [(ngModel)]="interviewDetails.subject"
            required />
        </div>
        <div class="form-group">
          <label for="content">Content*</label>
          <textarea id="content" placeholder="Content/ List of Additional Documents*"
            [(ngModel)]="interviewDetails.content" required></textarea>
        </div>
        <div class="form-group">
          <label for="districtOffice">District Office*</label>
          <select id="districtOffice" [(ngModel)]="interviewDetails.districtOffice" required>
            <option value="" disabled selected>Select District Office*</option>
            <option *ngFor="let office of districtOffices" [value]="office">
              {{ office }}
            </option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn back" (click)="closeScheduleInterviewModal()">Cancel</button>
        <button class="btn send-invite" [disabled]="!isFormValid()" (click)="sendInvite()">Send Invite</button>
      </div>
    </div>
  </div>

  <!-- Document Upload Modal -->
  <div class="uploadDocumentModal" *ngIf="showDocumentUploadModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Documents</h3>
        <!-- Close Button -->
        <button class="close-button" (click)="closeDocumentUploadModal()">×</button>
      </div>
      <div class="modal-body">
        <div *ngFor="let document of documents; let i = index" class="document-row">
          <select class="dropdown" [(ngModel)]="document.category" required>
            <option value="" disabled selected>Doc Category *</option>
            <option *ngFor="let category of docCategories" [value]="category">
              {{ category }}
            </option>
          </select>
          <select class="dropdown" [(ngModel)]="document.title" required>
            <option value="" disabled selected>Doc Title *</option>
            <option *ngFor="let title of docTitles" [value]="title">
              {{ title }}
            </option>
          </select>
          <input type="file" (change)="onFileSelect($event, i)" required />
          <span class="file-name">{{ document.fileName }}</span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn back" (click)="closeDocumentUploadModal()">Cancel</button>
        <button class="btn add" (click)="addDocumentRow()">Upload Another Doc</button>
        <button class="btn approve" (click)="confirmAndApprove()">Confirm & Approve</button>
      </div>
    </div>

  </div>