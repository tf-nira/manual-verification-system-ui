<div class="container">
  <!-- Header Component (view, role) -->
  <app-header [view]="'List'" [role]="role"></app-header>

  <!-- Search & Filters Component (role) -->
  <div class="search-container">

    <div class="search-and-filters" *ngIf="!isFiltersCollapsed">
      <!-- Application ID -->
      <div class="input-group">
        <label for="searchText">Application ID</label>
        <input
          type="text"
          id="searchText"
          [(ngModel)]="searchText"
          placeholder="Search by Application ID"
          class="search-input"
        />
      </div>
  
      <!-- Service -->
      <div class="input-group">
        <label for="selectedService">Service</label>
        <select
          id="selectedService"
          [(ngModel)]="selectedService"
          (change)="onServiceChange($event)"
          class="search-input"
        >
          <option value="" disabled selected>Select a Service</option>
          <option *ngFor="let service of servicesWithTypes" [value]="service.value">
            {{ service.label }}
          </option>
        </select>
      </div>

      <!-- Service Type -->
      <div class="input-group">
        <label for="selectedServiceType">Service Type</label>
        <select
          id="selectedServiceType"
          [(ngModel)]="selectedServiceType"
          (change)="onServiceTypeChange($event)"
          class="search-input"
          [disabled]="!selectedService"
        >
          <option value="" disabled selected>Select a Service Type</option>
          <option *ngFor="let serviceType of filteredServiceTypes" [value]="serviceType.value">
            {{ serviceType.label }}
          </option>
        </select>
      </div>


      <!-- Application Status -->
      <div class="input-group" *ngIf="role === constants.MVS_DISTRICT_OFFICER || role === constants.MVS_LEGAL_OFFICER">
        <label for="selectedApplicationStatus">Application Status</label>
        <select
          id="selectedApplicationStatus"
          [(ngModel)]="selectedApplicationStatus"
          class="search-input"
        >
          <option value="" disabled selected>Select a Status</option>
          <option *ngFor="let status of applicationStatuses" [value]="status">{{ status }}</option>
        </select>
      </div>
      <!-- Age Group Multi-Select Dropdown -->
      <div class="input-group" *ngIf="selectedServiceType !== 'Registration of Citizens by Registration'
            && selectedServiceType !== 'Registration of Citizens by Naturalization'">
        <label for="ageGroupDropdown">Select Age Group</label>
        <div class="custom-multi-select">
          <!-- Dropdown Trigger -->
          <div id="ageGroupDropdown" class="dropdown-toggle" (click)="toggleDropdown()">
            Select Age Group
          </div>
      
          <!-- Dropdown Options -->
          <div class="dropdown-options" *ngIf="dropdownOpen">
            <label *ngFor="let age of ageGroups">
              <input type="checkbox" [value]="age" (change)="toggleSelection(age)" 
                     [checked]="selectedAgeGroups.includes(age)" />
              {{ age }}
            </label>
          </div>
        </div>
      </div>
      
      
    <!--Foundling-->
    <div class="input-group checkbox-container" *ngIf="selectedServiceType === 'Registration of citizens by birth'">
      <label for="foundlingCheckbox">Foundling</label>
      <input type="checkbox" id="foundlingCheckbox" [(ngModel)]="foundling"  class="checkbox-input"/>
    
    </div>
    </div>
    
    
    <div class="search-box">
      <div class="search-and-filters" *ngIf="!isFiltersCollapsed">
        <!-- Date Range Filter -->
        <div class="date-filter">
          <div class="input-group">
            <label for="fromDate">{{ constants.FROM_DATE }}</label>
            <mat-form-field appearance="outline" class="small-datepicker">
              <input
                matInput
                [matDatepicker]="fromPicker"
                [(ngModel)]="fromDate"
                (ngModelChange)="updateMinToDate()"
                [max]="fromDateMax"
                placeholder="DD/MM/YYYY"
              />
              <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
              <mat-datepicker #fromPicker></mat-datepicker>
            </mat-form-field>
          </div>
        
          <div class="input-group">
            <label for="toDate">{{ constants.TO_DATE }}</label>
            <mat-form-field appearance="outline" class="small-datepicker">
              <input
                matInput
                [matDatepicker]="toPicker"
                [(ngModel)]="toDate"
                (ngModelChange)="updateMaxFromDate()"
                [min]="minToDate"
                [max]="fromDateMax"
                placeholder="DD/MM/YYYY"
              />
              <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
              <mat-datepicker #toPicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
        
      </div>
      
      <div class="seach-and-filter-buttons">
        <button (click)="clearFilters()" class="clear-filters-btn">
          {{ constants.CLEAR_FILTERS }}
        </button>
        <button (click)="search()" class="clear-filters-btn">
          {{ constants.SEARCH }}
        </button>
        <button (click)="toggleFilters()" class="clear-filters-btn">
          {{ isFiltersCollapsed ? 'Filters' : 'Hide Filters' }}
        </button>
      </div>
    </div>
    
  </div>
  
    <!-- Main Content: Table and Right Panel -->
    <div class="main-content">
      <!-- Table Section -->
      <div class="left-section">
        <div class="application-list">
          <table class="styled-table"> 
            <thead>
              <tr>
                <th (click)="sortData(constants.API_CONST_APPLICATION_ID)">
                  {{ constants.APPLICATION_ID }}
                  <span [class]="getSortClass(constants.API_CONST_APPLICATION_ID)"></span>
                </th>
                <th (click)="sortData(constants.API_CONST_SERVICE)">
                  {{ constants.SERVICE }}
                  <span [class]="getSortClass(constants.API_CONST_SERVICE)"></span>
                </th>
                <th (click)="sortData(constants.API_CONST_SERVICE_TYPE)">
                  {{ constants.SERVICE_TYPE }}
                  <span [class]="getSortClass(constants.API_CONST_SERVICE_TYPE)"></span>
                </th>
                <th (click)="sortData(constants.API_CONST_CREATED_DATE)">
                  {{ constants.CREATED_DATE }}
                  <span [class]="getSortClass(constants.API_CONST_CREATED_DATE)"></span>
                </th>
                <th *ngIf="role === constants.MVS_DISTRICT_OFFICER || role === constants.MVS_LEGAL_OFFICER" (click)="sortData(constants.APPLICATION_STATUS)">
                  {{ constants.APPLICATION_STATUS }}
                  <span [class]="getSortClass(constants.APPLICATION_STATUS)"></span>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of data" (click)="onRowClick($event, row)">
                <td>
                  <span>{{ row[constants.API_CONST_APPLICATION_ID] }}</span>
                  <!-- <button (click)="onRowClick($event, row)" class="navigate-btn">
                    Open
                  </button> -->
                </td>
                <td>{{ row[constants.API_CONST_SERVICE] }}</td>
                <td>{{ row[constants.API_CONST_SERVICE_TYPE] }}</td>
                <td>{{ row[constants.API_CONST_CREATED_DATE] | date: 'dd-MM-yyyy HH:mm:ss'  }}</td>
                <td *ngIf="role === constants.MVS_DISTRICT_OFFICER || role === constants.MVS_LEGAL_OFFICER">
                  {{ row[constants.API_CONST_STATUS] === 'INTERVIEW SCHEDULED' ? 'Interview Scheduled' : 'Pending' }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  

  <div *ngIf="totalPages > 0" class="pagination-controls">
    <button
      (click)="changePage(0)"
      [disabled]="currentPage === 0"
      class="pagination-btn"
    >
      &#x23EE;
      <!-- First Page -->
    </button>

    <button
      (click)="changePage(currentPage - 1)"
      [disabled]="currentPage === 0"
      class="pagination-btn"
    >
      &#x2039;
      <!-- Previous Page -->
    </button>

    <span class="pagination-text">
      Page
      <input
        type="number"
        [(ngModel)]="temp"
        (change)="jumpToPage(temp)"
        class="pagination-input"
      />
      of {{ totalPages }}
    </span>

    <button
      (click)="changePage(currentPage + 1)"
      [disabled]="currentPage === totalPages - 1"
      class="pagination-btn"
    >
      &#x203A;
      <!-- Next Page -->
    </button>

    <button
      (click)="changePage(totalPages - 1)"
      [disabled]="currentPage === totalPages - 1"
      class="pagination-btn"
    >
      &#x23ED;
      <!-- Last Page -->
    </button>
  </div>
</div>
